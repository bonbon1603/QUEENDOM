<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Q&A - User</title>

<!-- ICONS: inline SVG symbols -->
<svg style="display:none">
  <symbol id="ic-user" viewBox="0 0 24 24"><circle cx="12" cy="8" r="3.2"/><path d="M4 20c0-3.3 3.6-6 8-6s8 2.7 8 6"/></symbol>
  <symbol id="ic-admin" viewBox="0 0 24 24"><path d="M12 2l2.2 4.4L19 7l-3.4 3 0.8 4.6L12 12.8 7.6 14.6 8.4 10 5 7l4.8-0.6L12 2z"/></symbol>
  <symbol id="ic-send" viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/></symbol>
  <symbol id="ic-answer" viewBox="0 0 24 24"><path d="M20 2H4v14h6v6l6-6h4z"/></symbol>
  <symbol id="ic-star" viewBox="0 0 24 24"><path d="M12 17.3L18.2 21l-1.6-6.3L22 9.2l-6.5-.6L12 3 9.5 8.6 3 9.2 7.4 14.7 5.8 21z"/></symbol>
</svg>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;700;800&display=swap');

  :root{
    --accent1: #88b7ff;
    --accent2: #c89bff;
    --glass: rgba(255,255,255,0.6);
  }

  body{
    margin:0;
    font-family: "Nunito", Arial, sans-serif;
    background: url("paper.png") center/cover fixed;
    color:#102037;
    -webkit-font-smoothing:antialiased;
  }

  /* header d·∫°ng bong b√≥ng ‚Äì tr√≤n ‚Äì trong su·ªët ‚Äì glass bubble */
.header{
    margin: 20px auto 10px;
    padding: 18px 28px;
    width: fit-content;

    background: rgba(255,255,255,0.25);
    backdrop-filter: blur(14px) saturate(160%);
    -webkit-backdrop-filter: blur(14px) saturate(160%);

    border-radius: 40px;
    border: 2px solid rgba(255,255,255,0.45);
    
    font-size: 26px;
    font-weight: 800;
    color: #ffffff;
    text-shadow: 0 2px 6px rgba(0,0,0,0.2);

    box-shadow:
      0 6px 20px rgba(255,255,255,0.28),
      inset 0 4px 10px rgba(255,255,255,0.45),
      inset 0 -4px 12px rgba(150,180,255,0.25);

    position: relative;
    overflow: hidden;
}

/* hi·ªáu ·ª©ng tr√°ng k√≠nh ch·∫°y ngang */
.header::after{
    content:'';
    position:absolute;
    top:0; left:-60%;
    width:50%; height:100%;
    background: linear-gradient(
        120deg,
        rgba(255,255,255,0.15),
        rgba(255,255,255,0.55),
        rgba(255,255,255,0.15)
    );
    transform: skewX(-20deg);
    animation: headerShine 3.6s infinite linear;
}

@keyframes headerShine{
    0%{ left:-60%; }
    100%{ left:130%; }
}


  /* layout */
  .wrap{ max-width:900px; margin:22px auto; padding:12px; }
  .chat-box{
    height:70vh;
    overflow:auto;
    display:flex;
    flex-direction:column;
    gap:14px;
    padding:18px;
  }

  /* message bubble */
  .msg {
    display:flex;
    gap:12px;
    align-items:flex-end;
    animation: slideIn .28s ease;
  }
  @keyframes slideIn { from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }

  .avatar {
    width:48px; height:48px; border-radius:50%;
    flex-shrink:0; display:grid; place-items:center;
    background: linear-gradient(135deg,var(--accent1),var(--accent2));
    box-shadow: 0 8px 18px rgba(80,100,200,0.14);
    color:white;
  }
  .bubble {
    background: var(--glass);
    padding:12px 14px;
    border-radius:14px;
    border: 1px solid rgba(255,255,255,0.7);
    backdrop-filter: blur(8px);
    max-width:78%;
    position:relative;
    box-shadow: 0 10px 30px rgba(30,60,120,0.08);
  }
  .bubble .text{ font-weight:600; font-size:16px; color:#15304f }
  .bubble .meta{ font-size:12px; color:rgba(20,30,40,0.55); margin-top:6px; text-align:right }

  /* answer style (admin) */
  .answerBox {
    margin-top:8px;
    background: linear-gradient(180deg, rgba(220,240,255,0.9), rgba(230,225,255,0.9));
    padding:10px;
    border-radius:10px;
    border: 1px solid rgba(140,120,200,0.25);
    font-size:14px;
    color:#26334a;
    box-shadow: inset 0 4px 12px rgba(255,255,255,0.6);
    animation: popIn .28s ease;
  }
  @keyframes popIn{ from{transform:scale(.98);opacity:0} to{transform:none;opacity:1} }

  /* input area */
  .composer {
    display:flex; gap:12px; padding:12px; align-items:center; background:transparent;
  }
  .composer input{
    flex:1; padding:12px 14px; border-radius:12px; border:none;
    background: rgba(255,255,255,0.9); box-shadow: inset 0 6px 18px rgba(0,0,0,0.06);
    font-size:15px; outline:none;
  }
  .btn-send{
    width:56px; height:56px; border-radius:50%; border:none; cursor:pointer;
    display:grid; place-items:center;
    background: linear-gradient(135deg,var(--accent1),var(--accent2));
    box-shadow: 0 10px 30px rgba(80,100,200,0.18);
    transition: all .18s;
  }
  .btn-send:hover{ transform:translateY(-4px); box-shadow: 0 16px 40px rgba(80,100,200,0.26) }

  /* new badge */
  .badge-new{
    position:absolute; right:-8px; top:-8px; background:#ff6b81; color:white;
    font-size:11px; padding:4px 6px; border-radius:50px; box-shadow:0 6px 18px rgba(255,107,129,0.18);
    transform:translateY(-2px);
    animation: bounce 1.2s infinite ease-in-out;
  }
  @keyframes bounce{ 0%{transform:translateY(-2px)}50%{transform:translateY(2px)}100%{transform:translateY(-2px)} }

  /* floating sparkles */
  .sparkle {
    position:fixed; pointer-events:none; z-index:30; opacity:.9;
    animation: floaty 6s linear infinite;
    filter: drop-shadow(0 6px 18px rgba(120,120,255,0.12));
  }
  @keyframes floaty { 0%{transform:translateY(0) rotate(0)} 50%{transform:translateY(-22px) rotate(12deg)} 100%{transform:translateY(0) rotate(0)} }

  /* small notification */
  .notice {
    position:fixed; right:18px; bottom:18px; background:linear-gradient(180deg,#fff,#f7f9ff);
    padding:12px 14px; border-radius:12px; box-shadow:0 12px 30px rgba(20,40,80,0.12);
  }

  /* responsive */
  @media (max-width:600px){
    .avatar{width:44px;height:44px}
    .bubble{max-width:82%}
    .header{font-size:20px}
  }
</style>
</head>
<body>

<div class="header">Q&A</div>

<div class="wrap">
  <div id="chatBox" class="chat-box"></div>

  <div class="composer">
    <input id="questionInput" placeholder="Type something... (e.g: what's your name? )" />
    <button class="btn-send" id="sendBtn" title="Send">
      <svg width="22" height="22"><use href="#ic-send" /></svg>
    </button>
  </div>
</div>

<!-- small sparkles -->
<svg class="sparkle" style="left:40px; top:120px; width:48px; height:48px;">
  <use href="#ic-star" fill="rgba(255,255,255,0.8)"></use>
</svg>
<svg class="sparkle" style="right:80px; top:80px; width:36px; height:36px; animation-duration:7s;">
  <use href="#ic-star" fill="rgba(255,240,255,0.86)"></use>
</svg>

<script>
/* === KI·ªÇM TRA LOGIN === */
/* --- CH√ö √ù ---:
   - Trang ƒëƒÉng nh·∫≠p (new.html / signin.html) ph·∫£i set localStorage.setItem("user_logged_in","yes")
   - M√¨nh d√πng key: "user_logged_in" ƒë·ªÉ ƒë·ªìng b·ªô gi·ªØa c√°c tab
*/

let isLogged = localStorage.getItem("user_logged_in") === "yes";

const chatBox = document.getElementById('chatBox');
const input   = document.getElementById('questionInput');
const sendBtn = document.getElementById('sendBtn');

/* kh√≥a input n·∫øu ch∆∞a login */
function updateLoginStateUI(){
  if(!isLogged){
    input.disabled = true;
    sendBtn.disabled = true;
    input.placeholder = "‚ö† B·∫°n ph·∫£i ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi g·ª≠i c√¢u h·ªèi!";
    sendBtn.style.opacity = "0.4";
  } else {
    input.disabled = false;
    sendBtn.disabled = false;
    input.placeholder = "Type something...";
    sendBtn.style.opacity = "1";
  }
}
updateLoginStateUI();

/* th√¥ng b√°o ƒë·∫πp */
function flash(text){
  const n = document.createElement('div');
  n.className = 'notice';
  n.innerText = text;
  document.body.appendChild(n);
  setTimeout(()=> n.style.opacity = '0', 3000);
  setTimeout(()=> n.remove(), 3800);
}

/* l·∫Øng nghe thay ƒë·ªïi ƒëƒÉng nh·∫≠p t·ª´ tab kh√°c (cross-tab) */
window.addEventListener('storage', function(e){
  try{
    if(e.key === 'user_logged_in'){
      isLogged = e.newValue === 'yes';
      updateLoginStateUI();
      if(isLogged) flash('üéâ ƒê√£ ƒëƒÉng nh·∫≠p ‚Äî b·∫°n c√≥ th·ªÉ g·ª≠i c√¢u h·ªèi.');
      else flash('üîí B·∫°n ƒë√£ ƒëƒÉng xu·∫•t.');
    }
    // data QA thay ƒë·ªïi ·ªü tab kh√°c -> render l·∫°i
    if(e.key === 'qa_data' || e.key === 'qa_update') render();
  }catch(err){
    console.warn('storage handler err', err);
  }
});

/* message event fallback (n·∫øu page ƒëƒÉng nh·∫≠p g·ª≠i postMessage) */
window.addEventListener("message", ev=>{
  if(ev.data === "logged"){
    localStorage.setItem("user_logged_in","yes");
    isLogged = true;
    updateLoginStateUI();
    flash("üéâ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
  }
});

/* channel */
const channel = (typeof BroadcastChannel !== 'undefined') ? new BroadcastChannel('qa_channel') : null;

function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"'`=\/]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'})[c]); }

/* render Q&A */
function render(){
  const data = JSON.parse(localStorage.getItem('qa_data')) || [];
  chatBox.innerHTML = '';
  data.sort((a,b)=>a.id - b.id);
  data.forEach(msg=>{
    const div = document.createElement('div');
    div.className = 'msg';
    div.innerHTML = `
      <div class="avatar"><svg width="22" height="22" fill="white"><use href="#ic-user"></use></svg></div>
      <div>
        <div class="bubble">
          <div class="text">${escapeHtml(msg.text)}</div>
          <div class="meta">${msg.time}</div>
          ${
            msg.answer
            ? `<div class="answerBox">üí¨ ${escapeHtml(msg.answer)}${ msg.answeredAt ? `<div style="font-size:11px;color:#5b6b80;margin-top:6px">Tr·∫£ l·ªùi: ${escapeHtml(msg.answeredAt)}</div>` : '' }</div>`
            : ""
          }
        </div>
      </div>
    `;
    chatBox.appendChild(div);
  });
  chatBox.scrollTop = chatBox.scrollHeight;
}

/* g·ª≠i c√¢u h·ªèi */
function sendQuestion(){
  if(!isLogged){
    flash("üö´ B·∫°n ph·∫£i ƒëƒÉng nh·∫≠p ƒë·ªÉ g·ª≠i tin!");
    return;
  }
  const text = input.value.trim();
  if(!text) return;

  const data = JSON.parse(localStorage.getItem('qa_data')) || [];
  const obj = {
    id: Date.now(),
    text,
    time: new Date().toLocaleString(),
    answer:'',
    answeredAt:''
  };
  data.push(obj);
  localStorage.setItem('qa_data', JSON.stringify(data));
  // notify other tabs (some browsers require changing value to trigger storage)
  try{ localStorage.setItem('qa_update', Date.now().toString()); }catch(e){}

  if(channel) channel.postMessage({type:'new', id: obj.id});

  input.value='';
  render();
}

sendBtn.addEventListener('click', sendQuestion);
input.addEventListener('keydown', e=>{ if(e.key==='Enter') sendQuestion(); });

/* nh·∫≠n tr·∫£ l·ªùi t·ª´ admin */
if(channel){
  channel.onmessage = ev=>{
    const d = ev.data;
    if(!d) return;
    if(d.type === 'answer'){
      const data = JSON.parse(localStorage.getItem('qa_data')) || [];
      const idx = data.findIndex(x=>x.id===d.id);
      if(idx>=0){
        data[idx].answer = d.answer;
        data[idx].answeredAt = d.answeredAt;
        localStorage.setItem('qa_data', JSON.stringify(data));
      }
      flash("‚ú® B·∫°n c√≥ tin nh·∫Øn m·ªõi!");
      render();
    }
    if(d.type === 'new'){ render(); }
  };
}

window.addEventListener('storage', e=>{
  if(e.key === 'qa_data') render();
});

/* kh·ªüi t·∫°o */
render();
</script>

</body>
</html>

