<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dịch câu → Ngôn ngữ kí hiệu</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:wght@300;500&display=swap" rel="stylesheet">

<style>
/* ===================== Base / layout ===================== */
:root{
  --bg-left: #12000b;    /* very dark */
  --bg-right: #6b0a8a;   /* purple */
  --accent: #c85bff;
  --muted: rgba(255,255,255,0.08);
  --card-bg: rgba(10,6,12,0.6);
  --pill-bg: rgba(255,255,255,0.08);
  --glass: rgba(255,255,255,0.04);
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(120deg,var(--bg-left),var(--bg-right));font-family:"Cormorant Garamond", "Cinzel", serif;color:#fff;}

/* sparkle overlay */
body::before{
  content:"";
  position:fixed; inset:0; z-index:0;
  pointer-events:none;
  background-image:
    radial-gradient(rgba(255,255,255,0.06) 1px, transparent 1px),
    radial-gradient(rgba(255,255,255,0.03) 1px, transparent 1px);
  background-size: 30px 30px, 80px 80px;
  opacity:0.28;
  mix-blend-mode:overlay;
  animation: sparkleShift 12s linear infinite;
  transform: translateZ(0);
}
@keyframes sparkleShift {
  0% { background-position: 0 0, 0 0; }
  50%{ background-position: 200px -100px, -150px 120px; }
  100%{ background-position: 0 0, 0 0; }
}

/* page container */
.container{
  position:relative;
  z-index:1;
  max-width:1100px;
  margin:38px auto;
  padding:28px;
  backdrop-filter: blur(6px);
}

/* hero/title */
.header{
  text-align:center;
  margin-bottom:24px;
}
.title{
  font-family:"Cinzel", serif;
  font-weight:700;
  letter-spacing:2px;
  font-size:44px;
  margin:6px 0;
  color: #fff;
  text-shadow: 0 6px 24px rgba(0,0,0,0.6);
}
.subtitle{
  margin-top:6px;
  color: rgba(255,255,255,0.75);
  font-size:14px;
}

/* form */
.controls{
  display:flex;
  gap:12px;
  justify-content:center;
  align-items:center;
  margin-top:18px;
  flex-wrap:wrap;
}

/* ====== IMPORTANT: textarea style kept to match original look,
   but min-height set small so it looks like 1-line when empty ====== */
#inputText{
  width:70%;
  min-width:260px;
  max-width:720px;
  min-height:42px;             /* <-- 1 dòng khi trống */
  max-height:400px;            /* giới hạn mở rộng */
  padding:14px 16px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.06);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
  color:white;
  font-size:16px;
  resize:none;                 /* người dùng không kéo */
  overflow-y:hidden;           /* ẩn scrollbar, JS sẽ mở rộng */
  outline:none;
  box-shadow: 0 6px 18px rgba(0,0,0,0.55), inset 0 -6px 12px rgba(255,255,255,0.01);
}
#inputText:focus{ box-shadow: 0 10px 30px rgba(0,0,0,0.6); border-color:var(--accent); }

.btn {
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:12px 18px;
  border-radius:12px;
  background: linear-gradient(180deg, var(--accent), #8d2aff);
  color:white;
  font-weight:600;
  text-decoration:none;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.12);
  box-shadow: 0 10px 18px rgba(109, 33, 161, 0.24);
  transition: transform .18s ease, box-shadow .18s ease, filter .18s;
}
.btn:hover{ transform: translateY(-4px); box-shadow: 0 18px 30px rgba(109, 33, 161, 0.34); filter:brightness(1.03); }
.btn:active{ transform: translateY(-1px); }

/* result area */
.result-wrap{
  margin-top:28px;
  display:flex;
  gap:20px;
  align-items:flex-start;
  justify-content:center;
  flex-wrap:wrap;
}

/* player column */
.player-col{
  width:680px;
  max-width:100%;
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:center;
}

/* card for player (glass) */
.player-card{
  width:100%;
  background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(10,6,12,0.6));
  border-radius:14px;
  padding:16px;
  position:relative;
  box-shadow: 0 24px 60px rgba(0,0,0,0.7);
  overflow:visible;
}

/* video wrapper + smoke aura */
.video-card{
  position:relative;
  width:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  border-radius:12px;
  padding:8px;
  transition: transform .22s cubic-bezier(.2,.9,.2,1), box-shadow .22s;
  transform-origin:center center;
}

/* smoky aura using pseudo-element behind */
.video-card::before{
  content:"";
  position:absolute;
  inset:6px;
  border-radius:12px;
  background: radial-gradient(ellipse at 50% 35%, rgba(0,0,0,0.75), rgba(0,0,0,0.85) 45%, rgba(0,0,0,0.95) 70%);
  filter: blur(20px) saturate(0.6);
  z-index:0;
  transition: filter .22s, transform .22s, opacity .22s;
  opacity:0.95;
}

/* actual video sits above aura */
.player-card video{
  width:100%;
  max-width:100%;
  border-radius:8px;
  display:block;
  position:relative;
  z-index:2;
  box-shadow: 0 10px 40px rgba(0,0,0,0.7);
  transition: transform .22s, box-shadow .22s, filter .22s;
  transform-origin:center center;
}

/* thumbnail row (small cards) */
.thumb-row{
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
  flex-wrap:wrap;
  margin-top:12px;
}
.thumb{
  width:120px;
  height:70px;
  border-radius:8px;
  overflow:hidden;
  position:relative;
  background:var(--pill-bg);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition: transform .18s ease, box-shadow .18s ease;
  border:1px solid rgba(255,255,255,0.04);
}
.thumb video{ width:100%; height:100%; object-fit:cover; display:block; filter:brightness(.7) saturate(.9); }
.thumb:hover{ transform:scale(1.10); box-shadow: 0 14px 36px rgba(0,0,0,0.6); z-index:4; }

/* scale & glow on hover for big card */
.video-card:hover{ transform: scale(1.02); }
.video-card:hover::before{ filter: blur(30px) saturate(1.1); transform: scale(1.05); opacity:1; }
.video-card:hover video{ transform: scale(1.03); filter:brightness(1.02); box-shadow: 0 20px 50px rgba(135,43,217,0.28); }

/* playlist pills */
#playlist{ display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:10px; }
.pill{ padding:8px 10px; border-radius:999px; background:var(--pill-bg); color:#fff; font-size:13px; border:1px solid rgba(255,255,255,0.04); }

#missing{ color:#ff9b9b; margin-top:10px; text-align:center; }

/* hide thumbnail row by default (you can remove this to see thumbnails) */
.thumb-row { display: none !important; }

/* footer small */
.footer{
  text-align:center;
  margin-top:26px;
  color:rgba(255,255,255,0.6);
  font-size:13px;
}

/* Responsive tweaks */
@media (max-width:880px){
  .controls textarea{ width:100% }
  .player-col{ width:100%; padding:0 12px; }
  .title{ font-size:36px; }
}
.page-frame {
  position: fixed;
  inset: 0;
  border-radius: 28px;
  pointer-events: none;
  z-index: 0;
  box-shadow:
      0 0 90px rgba(255, 255, 255, 0.22),
      0 0 160px rgba(255, 120, 255, 0.18) inset;
}


</style>

</head>
<body>
<div class="page-frame"></div>

<div class="container">
  <div class="header">
    <div class="title">
      <span style='font-size:100px;'>&#9813;</span>
    </div>
    <div class="subtitle">Type an English sentence and see the sign sequence</div>
  </div>

  <div class="controls">
    <textarea id="inputText" placeholder="Type sentence (e.g. I love you)"></textarea>
    <div style="display:flex;flex-direction:column;gap:8px;">
      <button id="translateBtn" class="btn">Dịch</button>
      <button id="clearBtn" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);">Clear</button>
    </div>
  </div>

  <div class="result-wrap">
    <div class="player-col">
      <div class="player-card">
        <div class="video-card" id="videoCard">
 
  <!-- main player gets inserted here by JS -->
</div>


        <div id="playlist" style="display:flex;justify-content:center;gap:8px;margin-top:12px;"></div>

        <div id="missing" aria-live="polite"></div>
      </div>

      <div class="thumb-row" id="thumbRow" aria-hidden="true"></div>
    </div>
  </div>

  <div class="footer">&#127762;</div>
</div>

<script>
/* ===================== Logic (lexer + sequential player) ===================== */

/* dictionary: english word -> filename (just basename, we prefix with "videos/" later) */
const dictionary = {
  "i":"i.mp4",
  "you":"you.mp4",
  "love":"love.mp4",
  "know":"know.mp4",
  "understand":"understand.mp4",
  "what":"what.mp4"
  // add more mappings here...
};

/* normalize function */
function normalizeText(str){
  if(!str) return "";
  let s = str.toLowerCase().trim();
  s = s.normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  s = s.replace(/[^a-z0-9\s]/g, '');
  s = s.replace(/\s+/g,' ').trim();
  return s;
}

/* build normalized dictionary map and max phrase length */
const normalizedDict = {};
let maxPhraseLen = 1;
Object.keys(dictionary).forEach(k=>{
  const nk = normalizeText(k);
  if(!nk) return;
  normalizedDict[nk] = dictionary[k];
  const l = nk.split(' ').length;
  if(l > maxPhraseLen) maxPhraseLen = l;
});

/* greedy match tokens -> file list */
function buildFileListFromText(raw){
  const norm = normalizeText(raw);
  if(!norm) return {files:[], missing:[]};
  const tokens = norm.split(' ');
  const files = [];
  const missing = [];

  for(let i=0;i<tokens.length;i++){
    let matched=false;
    for(let len=Math.min(maxPhraseLen, tokens.length - i); len>=1; len--){
      const phrase = tokens.slice(i, i+len).join(' ');
      if(normalizedDict[phrase]){
        files.push("videos/" + normalizedDict[phrase]);
        i += (len-1);
        matched=true;
        break;
      }
    }
    if(!matched){
      // you can choose to ignore some common stopwords here if desired
      missing.push(tokens[i]);
    }
  }
  return {files, missing};
}

/* preload small */
function preload(files){
  files.forEach(f=>{
    const v = document.createElement('video');
    v.preload = 'auto'; v.src = f;
  });
}

/* play sequence on one player; also build thumb row and playlist pills */
function playSequence(files){
  const videoCard = document.getElementById('videoCard');
  const playlistEl = document.getElementById('playlist');
  const thumbRow = document.getElementById('thumbRow');
  videoCard.innerHTML = '';
  playlistEl.innerHTML = '';
  thumbRow.innerHTML = '';

  if(files.length === 0) return;

  // create main player
  const player = document.createElement('video');
  player.controls = true;
  player.muted = true;
  player.playsInline = true;
  player.width = 640;
  player.style.borderRadius = '8px';
  player.style.background = '#000';
  videoCard.appendChild(player);

  // create pills & thumbs
  files.forEach((f, idx)=>{
    const pill = document.createElement('div');
    pill.className = 'pill';
    pill.textContent = (f.split('/').pop() || f).replace('.mp4','');
    pill.addEventListener('click', ()=> {
      currentIndex = idx;
      tryPlay(currentIndex);
    });
    playlistEl.appendChild(pill);

    // thumbnail small video (we create but CSS hides .thumb-row by default)
    const thumb = document.createElement('div');
    thumb.className = 'thumb';
    const tvid = document.createElement('video');
    tvid.muted = true;
    tvid.src = f;
    tvid.preload = 'metadata';
    tvid.playsInline = true;
    tvid.style.objectFit = 'cover';
    thumb.appendChild(tvid);
    thumb.addEventListener('click', ()=> {
      currentIndex = idx;
      tryPlay(currentIndex);
    });
    thumbRow.appendChild(thumb);
  });

  preload(files);

  // playback control
  let currentIndex = 0;
  function tryPlay(i){
    if(i >= files.length) return;
    const src = files[i];
    player.src = src;
    // visually highlight current pill
    [...playlistEl.children].forEach((p, pi)=> {
      p.style.opacity = (pi===i? '1':'0.55');
      p.style.transform = (pi===i? 'translateY(-4px) scale(1.02)':'none');
    });
    // play and handle promise
    const promise = player.play();
    if(promise !== undefined){
      promise.catch(err => {
        // autoplay blocked — rely on user click; show a subtle instruction
        console.warn('Autoplay blocked; user must interact to start playback.', err);
      });
    }
  }

  player.onended = function(){
    currentIndex++;
    if(currentIndex < files.length) tryPlay(currentIndex);
  };

  player.onerror = function(e){
    console.warn('Error playing file, skipping to next', e);
    currentIndex++;
    if(currentIndex < files.length) tryPlay(currentIndex);
  };

  // start playback
  tryPlay(0);
}

/* ---------- Buttons and interactions ---------- */
const translateBtn = document.getElementById('translateBtn');
const clearBtn = document.getElementById('clearBtn');
const inputEl = document.getElementById('inputText');

translateBtn.addEventListener('click', ()=>{
  const text = inputEl.value || '';
  const {files, missing} = buildFileListFromText(text);
  // show missing
  if(missing.length){
    document.getElementById('missing').textContent = 'Không tìm thấy video cho: ' + missing.join(', ');
  } else {
    document.getElementById('missing').textContent = '';
  }
  if(files.length){
    playSequence(files);
  } else if(!missing.length) {
    document.getElementById('missing').textContent = 'Vui lòng nhập nội dung.';
  }
});

clearBtn.addEventListener('click', ()=>{
  inputEl.value = '';
  inputEl.style.height = '';
  document.getElementById('videoCard').innerHTML = '';
  document.getElementById('playlist').innerHTML = '';
  document.getElementById('thumbRow').innerHTML = '';
  document.getElementById('missing').textContent = '';
});

/* Auto-expand textarea: keep it small when empty, expand as user types */
inputEl.addEventListener("input", function () {
    this.style.height = "auto";            // reset to compute scrollHeight correctly
    this.style.height = (this.scrollHeight) + "px";
});
</script>

</body>
</html>
